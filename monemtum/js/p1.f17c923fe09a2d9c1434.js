(()=>{"use strict";function t(){this.entries=[]}t.prototype.add=function(t,e,i){this.entries.push({element:t,event:e,fn:i}),t.addEventListener(e,i)},t.prototype.removeAll=function(){this.entries=this.entries.filter((function(t){return t.element.removeEventListener(t.event,t.fn),!1}))};const e=document.querySelector("[data-geeting]"),i=new class{constructor(e){this.element=e,this.date=new Date,this.hours=this.date.getHours(),this.geeting=this.element.querySelector("[data-geeting-welcom]"),this.input=this.element.querySelector("[data-input-name]"),this._listeners=new t,this.name="",this._listeners.add(this.input,"change",this.getNameInput.bind(this)),this._listeners.add(window,"beforeunload",this.setLocalStorage.bind(this)),this._listeners.add(window,"load",this.getLocalStorage.bind(this)),this.setContent()}getTimeOfDay(){return this.hours/6>=0&&this.hours/6<1?"night":this.hours/6>=1&&this.hours/6<2?"morning":this.hours/6>=2&&this.hours/6<3?"afternoon":this.hours/6>=3&&this.hours/6<4?"evening":void 0}setContent(){this.geeting.textContent=`Good ${this.getTimeOfDay()}`}getNameInput(t){this.name=t.target.value}setLocalStorage(){localStorage.setItem("name",this.name)}getLocalStorage(){localStorage.getItem("name")&&(this.input.value=localStorage.getItem("name"))}}(e).getTimeOfDay(),s=[{title:"Aqua Caelestis",src:"../assets/sounds/Aqua Caelestis.mp3",duration:"58"},{title:"River Flows In You",src:"../assets/sounds/River Flows In You.mp3",duration:"97"},{title:"Ennio Morricone",src:"../assets/sounds/Ennio Morricone.mp3",duration:"97"},{title:"Summer Wind",src:"../assets/sounds/Summer Wind.mp3",duration:"110"}],a=document.querySelector("[data-main]"),n=document.querySelector("[data-body]"),r=document.querySelector("[data-weather]"),h=document.querySelector("[data-quotes]"),o=document.querySelector("[data-player]");new class{constructor(t){this.dateView=t.querySelector("[data-date]"),this.time=t.querySelector("[data-time]"),this.showTime()}showTime(){const t=new Date,e=t.toLocaleTimeString();this.time.textContent=e,setTimeout(this.showTime.bind(this),1e3),this.showDate(t)}showDate(t){const e=t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"});this.dateView.textContent=e}}(a),new class{constructor(e){this.element=e,this.next=this.element.querySelector("[data-slide-next]"),this.prev=this.element.querySelector("[data-slide-prev]"),this._listeners=new t,this._listeners.add(this.next,"click",this.getSlideNext.bind(this)),this._listeners.add(this.prev,"click",this.getSlidePrev.bind(this)),this.setBg()}getRandomNum(t,e){return Math.floor(Math.random()*(e-t)+t)}setBg(){const t=this.getRandomNum(1,20).toString().padStart(2,"0"),e=new Image;e.src=`https://raw.githubusercontent.com/Krautsou-Andrei/stage1-tasks/assets/images/${i}/${t}.jpg`,e.onload=()=>{this.element.style.backgroundImage=`url(${e.src})`}}getSlideNext(t){t<20?t+=1:t=1,this.setBg()}getSlidePrev(t){t>1?t-=1:t=20,this.setBg()}}(n),new class{constructor(e){this.element=e,this.temperature=this.element.querySelector("[data-weather-temperature]"),this.description=this.element.querySelector("[data-weather-description]"),this.wind=this.element.querySelector("[data-weather-wind]"),this.humidity=this.element.querySelector("[data-weather-humidity]"),this.icon=this.element.querySelector("[data-weather-icon]"),this.input=this.element.querySelector("[data-weather-input]"),this.error=this.element.querySelector("[date-weather-error]"),this._listeners=new t,this._listeners.add(this.input,"change",this.getValueInput.bind(this)),this._listeners.add(window,"beforeunload",this.setLocalStorage.bind(this)),this._listeners.add(window,"load",this.getLocalStorage.bind(this)),this.getWeather(this.city)}async getWeather(t="Минск"){const e=`https://api.openweathermap.org/data/2.5/weather?q=${t}&lang=ru&appid=8c04f670a92c56cecd95b20d818e447b&units=metric`,i=await fetch(e);if(i.ok){const t=await i.json();this.icon.className="weather-icon owf",this.icon.classList.add(`owf-${t.weather[0].id}`),this.temperature.textContent=`${Math.round(t.main.temp)}°C`,this.description.textContent=t.weather[0].description,this.wind.textContent=`${Math.round(t.wind.speed)} м/с`,this.humidity.textContent=`${Math.round(t.main.humidity)} %`}else this.error.textContent="Нет данных",this.temperature.textContent=" ",this.description.textContent=" ",this.wind.textContent=" ",this.humidity.textContent=" ";this.input.value=t}getValueInput(t){this.city=t.target.value,this.getWeather(this.city)}setLocalStorage(){localStorage.setItem("city",this.city)}getLocalStorage(){localStorage.getItem("city")&&(this.city=localStorage.getItem("city"),"undefined"!=this.city&&" "!=this.city||(this.city="Минск"),this.input.value=this.city)}}(r),new class{constructor(e){this.element=e,this.text=this.element.querySelector("[date-quotes-text]"),this.author=this.element.querySelector("[date-quotes-author]"),this.buttonChange=this.element.querySelector("[data-quotes-change]"),this._listeners=new t,this._listeners.add(this.buttonChange,"click",this.getQuotes.bind(this)),this.getQuotes()}getQuotes(){fetch("../assets/data/data.json").then((t=>t.json())).then((t=>{const e=this.getRandomNum(0,t.length);this.text.textContent=t[e].text,this.author.textContent=t[e].author}))}getRandomNum(t,e){return Math.floor(Math.random()*(e-t)+t)}}(h),new class{constructor(e){this.element=e,this.audio=this.element.querySelector("[data-player-audio]"),this.prev=this.element.querySelector("[data-player-prev]"),this.play=this.element.querySelector("[data-player-play]"),this.next=this.element.querySelector("[data-player-next]"),this.list=this.element.querySelector("[data-player-list]"),this.timeline=this.element.querySelector("[data-timeline]"),this.timeProgress=this.element.querySelector("[data-time-progress]"),this.timeCurrent=this.element.querySelector("[data-time-current]"),this.timeDivider=this.element.querySelector("[data-time-divider]"),this.currentTitleSing=this.element.querySelector("[data-current-title-sing]"),this.curreutSingNumber=this.element.querySelector("[data-current-sing-number]"),this.volumeSlider=this.element.querySelector("[data-volume-slider]"),this.volumePercentage=this.element.querySelector("[data-volume-percentage]"),this.volumeButton=this.element.querySelector("[data-volume-button]"),this.volumeIcon=this.element.querySelector("[data-volume-icon]"),this.isMuted=!1,this.currentSingPlay,this.timer=0,this.pauseTime=0,this.music=[],this.isPlay=!1,this.playNum=0,this._listeners=new t,this._listeners.add(this.play,"click",this.playAudio.bind(this)),this._listeners.add(this.next,"click",this.playNext.bind(this)),this._listeners.add(this.prev,"click",this.playPrev.bind(this)),this._listeners.add(this.volumeButton,"click",this.setMuted.bind(this)),this.createMusic(),this.loadedMusic.bind(this)(),this.getVolumeSlider()}playAudio(){this.audio.currentTime=0,this.audio.src=s[this.playNum].src,this.audio.onended=this.autoPlayNext.bind(this),this.isPlay?(this.pauseAudio(),this.isPlay=!1,this.play.classList.remove("pause")):(this.audio.currentTime=this.pauseTime,this.audio.play(),this.isPlay=!0,this.play.classList.add("pause")),this.getPlayList(),this.isPlay&&this.setProgress()}pauseAudio(){this.audio.pause(),this.isPlay=!1,clearInterval(this.timer)}playNext(){this.pauseTime=0,this.playNum<s.length-1?this.playNum++:this.playNum=0,this.isPlay&&(this.isPlay=!1),this.playAudio()}playPrev(){this.pauseTime=0,this.playNum>0?this.playNum--:this.playNum=s.length-1,this.isPlay&&(this.isPlay=!1),this.playAudio()}createMusic(){s.forEach((t=>{const e=document.createElement("li"),i=document.createElement("span");i.classList.add("play-item-icon"),i.dataset.itemIcon=!1,e.addEventListener("click",this.changeSing.bind(this)),e.classList.add("play-item"),e.textContent=`${t.title} | ${this.getTimeCodeFromNum(t.duration)}`,this.list.append(e),e.append(i),this.music.push(e)}))}changeSing(t){let e=t.currentTarget.textContent;e=e.split(" |")[0],e==this.currentSingPlay?(this.currentSingPlay=e,this.playAudio()):(this.currentSingPlay=e,this.music.forEach(((t,i)=>{t.textContent.split(" |")[0]==e&&(this.pauseTime=0,this.isPlay=!1,this.playNum=i,this.playAudio())}))),this.getPlayList()}getPlayList(){this.music.forEach(((t,e)=>{t.textContent.split(" |")[0]==s[this.playNum].title?(t.classList.add("item-active"),this.curreutSingNumber.textContent=`${e+1}.`,this.currentTitleSing.textContent=s[this.playNum].title,this.isPlay?document.querySelector(".item-active .play-item-icon").dataset.itemIcon=!0:document.querySelector(".item-active .play-item-icon").dataset.itemIcon=!1):t.classList.remove("item-active")}))}autoPlayNext(){this.pauseTime=0,this.playNext()}loadedMusic(){this.audio.currentTime=0,this.audio.src=s[this.playNum].src,this.getPlayList(),this.audio.addEventListener("loadeddata",(()=>{this.element.querySelector("[data-time-length]").textContent=this.getTimeCodeFromNum(this.audio.duration),this.audio.volume=.75}),!1),this.getTimeline()}getTimeline(){this.timeline.addEventListener("click",(t=>{const e=window.getComputedStyle(this.timeline).width,i=t.offsetX/parseInt(e)*this.audio.duration;this.audio.currentTime=i}),!1)}getVolumeSlider(){this.volumeSlider.addEventListener("click",(t=>{const e=window.getComputedStyle(this.volumeSlider).width,i=t.offsetX/parseInt(e);this.audio.volume=i,this.volumePercentage.style.width=100*i+"%",this.isMuted&&this.setMuted()}),!1)}setProgress(){this.timer=setInterval((()=>{this.timeProgress.style.width=this.audio.currentTime/this.audio.duration*100+"%",this.pauseTime=this.audio.currentTime,this.timeCurrent.textContent=this.getTimeCodeFromNum(this.audio.currentTime)}),500)}setMuted(){this.audio.muted=!this.audio.muted,this.audio.muted?(this.volumeIcon.classList.remove("icon-volumeMedium"),this.volumeIcon.classList.add("icon-volumeMute"),this.isMuted=!0):(this.volumeIcon.classList.add("icon-volumeMedium"),this.volumeIcon.classList.remove("icon-volumeMute"),this.isMuted=!1)}getTimeCodeFromNum(t){let e=parseInt(t),i=parseInt(e/60);e-=60*i;const s=parseInt(i/60);return i-=60*s,0===s?`${i}:${String(e%60).padStart(2,0)}`:`${String(s).padStart(2,0)}:${i}:${String(e%60).padStart(2,0)}`}}(o)})();